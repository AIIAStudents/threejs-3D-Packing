<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç³»çµ±è¨ºæ–·</title>
  <style>
    body {
      font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .test-card {
      background: white;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .test-card h3 {
      margin-top: 0;
      color: #333;
    }

    .status {
      padding: 8px 16px;
      border-radius: 4px;
      display: inline-block;
      margin: 10px 5px 10px 0;
      font-weight: bold;
    }

    .status.success {
      background: #4CAF50;
      color: white;
    }

    .status.error {
      background: #f44336;
      color: white;
    }

    .status.pending {
      background: #2196F3;
      color: white;
    }

    pre {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }

    button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background: #1976D2;
    }
  </style>
</head>

<body>
  <h1>ğŸ” 3D Packer ç³»çµ±è¨ºæ–·</h1>

  <div class="test-card">
    <h3>1. å‰ç«¯ç‹€æ…‹</h3>
    <div id="frontend-status" class="status pending">æª¢æŸ¥ä¸­...</div>
    <p>ç•¶å‰ URL: <code id="current-url"></code></p>
  </div>

  <div class="test-card">
    <h3>2. å¾Œç«¯é€£æ¥æ¸¬è©¦</h3>
    <button onclick="testBackend()">æ¸¬è©¦å¾Œç«¯</button>
    <div id="backend-status" class="status pending">ç­‰å¾…æ¸¬è©¦</div>
    <pre id="backend-result"></pre>
  </div>

  <div class="test-card">
    <h3>3. API ç«¯é»æ¸¬è©¦</h3>
    <button onclick="testGroups()">æ¸¬è©¦ /api/groups</button>
    <button onclick="testItems()">æ¸¬è©¦ /api/items</button>
    <button onclick="testZones()">æ¸¬è©¦ /api/zones</button>
    <div id="api-status"></div>
    <pre id="api-result"></pre>
  </div>

  <div class="test-card">
    <h3>4. æ•¸æ“šåº«å…§å®¹</h3>
    <button onclick="checkDatabase()">æª¢æŸ¥è³‡æ–™åº«</button>
    <pre id="db-result"></pre>
  </div>

  <div class="test-card">
    <h3>5. æ¨¡å¡ŠåŠ è¼‰æ¸¬è©¦</h3>
    <button onclick="testModuleLoading()">æ¸¬è©¦æ¨¡å¡Š</button>
    <pre id="module-result"></pre>
  </div>

  <script>
    const API_BASE = 'http://127.0.0.1:8888/api';

    // Initialize
    document.getElementById('current-url').textContent = window.location.href;
    document.getElementById('frontend-status').textContent = 'âœ“ å‰ç«¯æ­£å¸¸';
    document.getElementById('frontend-status').className = 'status success';

    async function testBackend() {
      const statusEl = document.getElementById('backend-status');
      const resultEl = document.getElementById('backend-result');

      statusEl.textContent = 'æ¸¬è©¦ä¸­...';
      statusEl.className = 'status pending';

      try {
        const response = await fetch(`${API_BASE}/v2/status`);
        const data = await response.json();

        statusEl.textContent = 'âœ“ å¾Œç«¯é€£æ¥æˆåŠŸ';
        statusEl.className = 'status success';
        resultEl.textContent = JSON.stringify(data, null, 2);
      } catch (error) {
        statusEl.textContent = 'âœ— å¾Œç«¯é€£æ¥å¤±æ•—';
        statusEl.className = 'status error';
        resultEl.textContent = `éŒ¯èª¤: ${error.message}\n\nè«‹ç¢ºèªå¾Œç«¯æœå‹™å™¨æ˜¯å¦æ­£åœ¨é‹è¡Œï¼š\npython start_servers.py`;
      }
    }

    async function testGroups() {
      await testEndpoint('/groups', 'Groups');
    }

    async function testItems() {
      await testEndpoint('/items', 'Items');
    }

    async function testZones() {
      await testEndpoint('/zones', 'Zones');
    }

    async function testEndpoint(endpoint, name) {
      const statusEl = document.getElementById('api-status');
      const resultEl = document.getElementById('api-result');

      statusEl.innerHTML = `<span class="status pending">æ¸¬è©¦ ${name}...</span>`;

      try {
        const response = await fetch(`${API_BASE}${endpoint}`);
        const data = await response.json();

        statusEl.innerHTML = `<span class="status success">âœ“ ${name} API æ­£å¸¸</span>`;
        resultEl.textContent = `${name} (${data.length || 0} ç­†):\n` + JSON.stringify(data, null, 2);
      } catch (error) {
        statusEl.innerHTML = `<span class="status error">âœ— ${name} API å¤±æ•—</span>`;
        resultEl.textContent = `éŒ¯èª¤: ${error.message}`;
      }
    }

    async function checkDatabase() {
      const resultEl = document.getElementById('db-result');
      resultEl.textContent = 'æª¢æŸ¥ä¸­...\n';

      try {
        const [groups, items, zones] = await Promise.all([
          fetch(`${API_BASE}/groups`).then(r => r.json()),
          fetch(`${API_BASE}/items`).then(r => r.json()),
          fetch(`${API_BASE}/zones`).then(r => r.json())
        ]);

        resultEl.textContent = `
è³‡æ–™åº«çµ±è¨ˆ:
- ç¾¤çµ„: ${groups.length} ç­†
- ç‰©ä»¶: ${items.length} ç­†  
- å€åŸŸ: ${zones.length} ç­†

ç¾¤çµ„åˆ—è¡¨:
${groups.map(g => `  - ${g.name} (ID: ${g.id})`).join('\n') || '  (ç„¡)'}

å€åŸŸåˆ—è¡¨:
${zones.map(z => `  - å€åŸŸ ${z.label} (${z.length}Ã—${z.width}Ã—${z.height})`).join('\n') || '  (ç„¡)'}
                `.trim();
      } catch (error) {
        resultEl.textContent = `éŒ¯èª¤: ${error.message}`;
      }
    }

    async function testModuleLoading() {
      const resultEl = document.getElementById('module-result');
      resultEl.textContent = 'æ¸¬è©¦ä¸­...\n';

      try {
        // Test if we can load a module
        const module = await import('/src/js_v2/group_items/add_inventory.js');
        resultEl.textContent = `âœ“ æ¨¡å¡ŠåŠ è¼‰æˆåŠŸ\n\næ¨¡å¡Šå°å‡º:\n${Object.keys(module).join(', ')}`;
      } catch (error) {
        resultEl.textContent = `âœ— æ¨¡å¡ŠåŠ è¼‰å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
      }
    }

    // Auto-test backend on load
    setTimeout(testBackend, 500);
  </script>
</body>

</html>