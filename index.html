<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>3D Bin Packing System</title>
    <link rel="stylesheet" href="./src/css/old_version/style.css">
    <link rel="stylesheet" href="./src/css/old_version/container.css">
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
    </style>
    <link 
      rel="stylesheet" 
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" 
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" 
      crossorigin="anonymous" 
      referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
    <link rel="stylesheet" href="./src/css/old_version/group_flow.css">
    <link rel="stylesheet" href="./src/css/old_version/ui_controls.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="./src/css/old_version/space_planning.css">
  </head>
  <body>
    <div id="app">
      <!-- 側邊欄開關按鈕 -->
      <div id="sidebar-toggle">
        <img src="./src/assets/webs/sidebar.png" alt="Toggle Sidebar" />
      </div>

      <!-- 左側工具列 -->
      <div id="left-sidebar">
        <div class="sidebar-header">
          <h2>物件管理</h2>
        </div>
        
        <!-- 功能按鈕區域 -->
        <div class="action-buttons">
          <button id="change-container-btn" class="action-btn secondary">
            <i class="fas fa-box-open"></i>
             Change container size
          </button>
          <button id="add-group-btn" class="action-btn primary">
            <i class="fas fa-folder-plus"></i>
             Add Group
          </button>
          <button id="add-item-btn" class="action-btn primary">
            <i class="fas fa-plus-square"></i>
             Add Item
          </button>
          
          <button id="execute-packing-btn" class="action-btn primary">
            <i class="fas fa-play"></i>
             Pack Selected Group
          </button>
          <button id="pack-all-btn" class="action-btn primary">
            <i class="fas fa-cubes"></i>
             Pack All Groups
          </button>
          <a href="." class="action-btn secondary" style="text-decoration: none; justify-content: center;" title="Refresh Page">
            <i class="fas fa-sync-alt"></i>
             Refresh
          </a>
        </div>



        <!-- 物件列表區域 -->
        <div class="objects-section">
          <div id="objects-list" class="objects-list">
            <div class="group collapsed">
              <div class="group-header">
                <i class="fas fa-chevron-right group-toggle"></i>
                <span class="group-name">Group 1</span>
                <div class="dropdown">
                  <button class="kebab">⋮</button>
                  <div class="dropdown-content">
                    <a href="#" class="menu-item" data-action="rename-group">修改名稱</a>
                    <a href="#" class="menu-item" data-action="delete-group">刪除群組</a>
                    <a href="#" class="menu-item" data-action="control-weight">控制權重</a>
                  </div>
                </div>
              </div>
              <div class="group-items">
                <div class="item">
                  <span class="item-name">Item A</span>
                  <button class="kebab">⋮</button>
                  <!-- 物件功能表 -->
                  <div class="menu">
                    <div class="menu-item">修改尺寸</div>
                    <div class="menu-item">狀態列</div>
                    <div class="menu-item">刪除物件</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 調整側邊欄寬度的拖曳條 -->
      <div id="resizer"></div>

      <!-- 右側3D場景 -->
      <div id="container">
        <canvas id="canvas"></canvas>

        <!-- 打包進度面板 -->
        <div id="packing-panel" class="floating-panel" style="display: none;">
          <div class="panel-header">
            <h3>3D Bin Packing</h3>
            <button class="close-btn" id="close-packing-panel">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="panel-content">
            <div id="packing-progress" class="progress-container">
              <div class="progress-status status-pending">準備中...</div>
              <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
              </div>
              <div class="progress-text">0%</div>
            </div>
            <div id="packing-results">
              <p><strong>體積利用率:</strong> <span id="utilization-text">-</span></p>
              <p><strong>執行時間:</strong> <span id="execution-time-text">-</span></p>
            </div>
            <button id="cancel-packing-btn" class="cancel-btn">取消打包</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 右上角視圖控制圖標 -->
    <div id="view-controls">
      <div class="view-icon" id="toggle-partitions-btn" title="切換容器分割標籤">
        <img src="./src/assets/webs/product-development.png" alt="Partitions">
      </div>
      <div class="view-icon" id="toggle-floor-btn" title="切換空間邊界">
        <img src="./src/assets/webs/floor.png" alt="Floor">
      </div>
      <div class="view-icon" id="toggle-axis-btn" title="切換座標軸">
        <img src="./src/assets/webs/axis.png" alt="Axis">
      </div>
    </div>

    <!-- Space Planning UI -->
    <div id="space-planning-view">
      <button id="close-space-planning-btn" class="modal-close-btn">&times;</button>
      <canvas id="top-down-canvas"></canvas>

      <div id="assignment-view-container">
        <div id="zone-list" class="assignment-column">
          <h3>空間區域 (Zones)</h3>
        </div>
        <div id="group-list" class="assignment-column">
          <h3>群組 (Groups)</h3>
        </div>
      </div>

      <div class="edit-mode-controls">
        <button id="btn-check" class="planning-button" title="Confirm Zone" style="display: none;" aria-label="Confirm Zone"><img src="./src/assets/group_space_edit/check.png"></button>
        <button id="btn-close" class="planning-button" title="Cancel Edit" style="display: none;" aria-label="Cancel Edit"><img src="./src/assets/group_space_edit/close.png"></button>
      </div>

      <div class="planning-controls">
        <button id="btn-next" class="planning-button" title="Next Step" disabled aria-label="Next Step"><img src="./src/assets/group_space_edit/next.png"></button>
        <button id="btn-edit" class="planning-button" title="Edit Zones" aria-label="Edit Zones"><img src="./src/assets/group_space_edit/edit.png"></button>
        <button id="btn-planning-main" class="planning-button" title="Execute Packing" style="display: none;" aria-label="Execute Packing"><img src="./src/assets/3D packing/play-button-arrowhead.png"></button>
      </div>

      <!-- Controls from the old flow editor, to be shown in the assignment phase -->
      <div id="group-flow-controls" class="flow-controls" style="display: none;">
        <button id="bin-btn" class="control-button" title="Delete Group"><img src="./src/assets/3D packing/bin.png"></button>
        <button id="history-btn" class="control-button" title="History"><img src="./src/assets/3D packing/history.png"></button>
        <button id="play-btn" class="control-button" title="Execute Packing"><img src="./src/assets/3D packing/play-button-arrowhead.png"></button>
        <button id="planning-btn" class="control-button" title="Edit Order"><img src="./src/assets/3D packing/planning.png"></button>
      </div>
    </div>

    <script type="module" src="./src/js/main.js"></script>

    <script src="./src/js/ripple.js" defer></script>

    <!-- Container Size Modal -->
    <div id="container-modal">
        <button id="modal-close-btn" class="modal-close-btn">&times;</button>
        <div class="modal-background"></div>
        <div class="modal-content">
            <div id="container-preview">
                <canvas id="container-canvas"></canvas>
            </div>
            <div id="container-controls">
                <div id="container-controls-content" class="scrollable-section">
                    <!-- Controls for shape and size will be dynamically added here -->
                </div>
            </div>
        </div>
        <div class="modal-icon-buttons">
            <button id="arrow-icon-btn" class="modal-icon-btn" title="Submit"><img src="./src/assets/container/arrow.png" width="24" height="24"></button>
            <button id="door-icon-btn" class="modal-icon-btn" title="Door"><img src="./src/assets/container/opened-door-aperture.png" width="24" height="24"></button>
            <button id="size-icon-btn" class="modal-icon-btn" title="Size"><img src="./src/assets/container/size.png" width="24" height="24"></button>
            <button id="container-icon-btn" class="modal-icon-btn" title="Container"><img src="./src/assets/container/container.png" width="24" height="24"></button>
        </div>
        
        <!-- Confirmation Dialogs -->
        <div id="submit-confirmation" class="confirmation-dialog">
            <p>確定使用容器?</p>
            <div class="btn-group">
                <button id="confirm-submit-yes" class="confirm-yes">是</button>
                <button id="confirm-submit-no" class="confirm-no">否</button>
            </div>
        </div>

        <div id="discard-confirmation" class="confirmation-dialog">
            <p>確定捨棄當前編輯?</p>
            <div class="btn-group">
                <button id="confirm-discard-yes" class="confirm-yes">是</button>
                <button id="confirm-discard-no" class="confirm-no">否</button>
            </div>
        </div>
    </div>

    <!-- Group Flow Editor UI -->
    <div id="group-flow-editor" style="display: none;">
      <button id="close-flow-editor-btn" class="modal-close-btn">&times;</button>
      <div id="group-flow-canvas"></div>

    </div>

      <div id="delete-group-dialog" class="confirmation-dialog">
        <p>確定要刪除群組?</p>
        <div class="btn-group">
          <button id="confirm-delete-yes" class="confirm-yes">是</button>
          <button id="confirm-delete-no" class="confirm-no">否</button>
        </div>
      </div>

            <div id="history-panel" class="history-panel">
              <div class="history-header">
                <h3>刪除紀錄</h3>
                <button id="close-history-panel" class="close-btn">&times;</button>
              </div>
              <div id="history-content" class="history-content">
                <p>目前沒有任何歷史紀錄</p>
              </div>
            </div>
          </div>
      
          <!-- Control Weight Editor UI -->
          <div id="control-weight-editor" style="display: none;">
            <button id="close-control-weight-editor-btn" class="modal-close-btn">&times;</button>
            <div id="sorting-controls" class="sorting-controls-container">
              <div class="control-group">
                  <label for="sort-order-select">排序模式</label>
                  <select id="sort-order-select" class="styled-select">
                      <option value="x>y>z" selected>X > Y > Z</option>
                      <option value="y>x>z">Y > X > Z</option>
                  </select>
              </div>
              <div class="control-group">
                  <label for="door-direction-select">正門方向</label>
                  <select id="door-direction-select" class="styled-select">
                      <option value="front" selected>前 (+Z)</option>
                      <option value="back">後 (-Z)</option>
                      <option value="left">左 (-X)</option>
                      <option value="right">右 (+X)</option>
                  </select>
              </div>
              <div class="control-group">
                  <label for="lifo-toggle">LIFO 模式</label>
                  <label class="switch">
                      <input type="checkbox" id="lifo-toggle">
                      <span class="slider round"></span>
                  </label>
              </div>
            </div>
            <div id="control-weight-canvas"></div> <!-- This will hold the list of items to reorder -->
      
            <div id="control-weight-controls" class="control-bar">
              <button id="cw-planning-btn" class="ctrl-btn planning" title="Edit Order"><img src="./src/assets/group weight/planning.png"></button>
              <button id="cw-arrow-btn" class="ctrl-btn arr" title="Confirm Order"><img src="./src/assets/group weight/arrow.png"></button>
              <button id="cw-history-btn" class="ctrl-btn history" title="History"><img src="./src/assets/group weight/history.png"></button>
              <button id="cw-bin-btn" class="ctrl-btn bin" title="Delete Item"><img src="./src/assets/group weight/bin.png"></button>
            </div>
      
            <!-- Confirmation Dialog for order change -->
            <div id="cw-confirm-order-dialog" class="confirmation-dialog">
              <p>是否決定更改順序?</p>
              <div class="btn-group">
                <button id="cw-confirm-order-yes" class="confirm-yes">是</button>
                <button id="cw-confirm-order-no" class="confirm-no">否</button>
              </div>
            </div>
      
            <!-- History Panel for deleted items -->
            <div id="cw-history-panel" class="history-panel">
              <div class="history-header">
                <h3>刪除紀錄</h3>
                <button id="cw-close-history-panel" class="close-btn">&times;</button>
              </div>
              <div id="cw-history-content" class="history-content">
                <p>目前沒有任何歷史紀錄</p>
              </div>
            </div>
          </div>
      
          <!-- Kebab menu icon -->
          <div id="kebab-menu-icon" class="kebab-icon" style="display: none;">
            <i class="fas fa-ellipsis-v"></i>
          </div>
          
          <!-- Item Edit Modal -->
          <div id="item-edit-modal" class="edit-modal" style="display: none;">
            <div class="modal-content">
                <h3>修改物件屬性</h3>
                
                <!-- Item Name -->
                <div class="input-group">
                    <label for="item-name-input">物件名稱</label>
                    <input type="text" id="item-name-input" class="text-input">
                </div>
      
                <!-- Dimensions -->
                <div class="input-group">
                    <label for="item-width-input">寬度 (Width): <span id="item-width-value"></span></label>
                    <input type="range" id="item-width-input" min="1" max="30" step="1">
                </div>
                <div class="input-group">
                    <label for="item-height-input">高度 (Height): <span id="item-height-value"></span></label>
                    <input type="range" id="item-height-input" min="1" max="30" step="1">
                </div>
                <div class="input-group">
                    <label for="item-depth-input">深度 (Depth): <span id="item-depth-value"></span></label>
                    <input type="range" id="item-depth-input" min="1" max="30" step="1">
                </div>
      
                <!-- Status Selection -->
                <div class="input-group">
                  <label>狀態</label>
                  <div class="status-btn-group">
                    <button class="status-btn" data-status="pending">尚未確認</button>
                    <button class="status-btn" data-status="confirmed">已確認</button>
                    <button class="status-btn" data-status="reconfirmed">補確認</button>
                  </div>
                </div>
      
                <!-- Action Buttons -->
                <div class="btn-group">
                    <button id="save-item-btn" class="confirm-yes">儲存</button>
                    <button id="cancel-edit-item-btn" class="confirm-no">取消</button>
                </div>
            </div>
          </div>
          
          <!-- Add Item Modal -->
          <div id="add-item-modal" class="edit-modal" style="display: none;">
            <div class="modal-content">
                <h3>批量新增物件 (Batch Add Items)</h3>
                
                <!-- Group Selection -->
                <div class="input-group">
                    <label for="item-group-select">選擇或建立群組 (Select or Create Group)</label>
                    <div style="display: flex; gap: 8px;">
                      <select id="item-group-select" class="text-input" style="flex-grow: 1;"></select>
                      <button id="create-new-group-btn" class="action-btn secondary" style="flex-shrink: 0;">New</button>
                    </div>
                    <div id="new-group-input-container" style="display: none; margin-top: 8px;">
                      <input type="text" id="new-group-name-input" class="text-input" placeholder="Enter new group name...">
                      <button id="confirm-new-group-btn" class="action-btn primary">Create</button>
                    </div>
                </div>
      
                <!-- Dimensions -->
                <div class="input-group dimensions-group" style="display: flex; gap: 10px;">
                    <div>
                        <label for="batch-add-width-input">寬度 (Width)</label>
                        <input type="number" id="batch-add-width-input" class="text-input" min="1" value="15">
                    </div>
                    <div>
                        <label for="batch-add-height-input">高度 (Height)</label>
                        <input type="number" id="batch-add-height-input" class="text-input" min="1" value="15">
                    </div>
                    <div>
                        <label for="batch-add-depth-input">深度 (Depth)</label>
                        <input type="number" id="batch-add-depth-input" class="text-input" min="1" value="15">
                    </div>
                </div>

                <!-- Quantity -->
                <div class="input-group">
                    <label for="item-quantity-input">數量 (Quantity)</label>
                    <input type="number" id="item-quantity-input" class="text-input" min="1" value="1">
                </div>
      
                <!-- Status Selection -->
                <div class="input-group">
                  <label for="item-status-select">設定狀態 (Set Status)</label>
                  <select id="item-status-select" class="text-input">
                    <option value="尚未確認">尚未確認 (Not Yet Confirmed)</option>
                    <option value="已確認">已確認 (Confirmed)</option>
                    <option value="補確認">補確認 (To Be Re-confirmed)</option>
                  </select>
                </div>
      
                <!-- Action Buttons -->
                <div class="btn-group">
                    <button id="submit-batch-add-btn" class="confirm-yes">新增 (Add)</button>
                    <button id="cancel-batch-add-btn" class="confirm-no">取消 (Cancel)</button>
                </div>
            </div>
          </div>
    <script>
      // This script block is now empty.
      // The UI logic has been centralized in the project's JavaScript modules
      // to prevent event handling conflicts.
    </script>
  </body>
</html>