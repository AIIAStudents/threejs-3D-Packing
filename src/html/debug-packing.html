<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Bin Packing - å•é¡Œè¨ºæ–·å·¥å…·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .diagnostic-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .diagnostic-section h3 {
            margin-top: 0;
            color: #ffd700;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        
        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .test-button.success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }
        
        .test-button.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }
        
        .test-button.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        .result-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border-left: 4px solid #ffd700;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background-color: #27ae60; }
        .status-error { background-color: #e74c3c; }
        .status-warning { background-color: #f39c12; }
        .status-info { background-color: #3498db; }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffd700;
        }
        
        .problem-category {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #e74c3c;
        }
        
        .problem-category h4 {
            margin-top: 0;
            color: #ff6b6b;
        }
        
        .solution {
            background: rgba(46, 204, 113, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #2ecc71;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ 3D Bin Packing å•é¡Œè¨ºæ–·å·¥å…·</h1>
        
        <div class="info-box">
            <strong>è¨ºæ–·ç›®çš„ï¼š</strong> ç³»çµ±æ€§æª¢æŸ¥ç‹€æ…‹æ›´æ–°ã€APIæ•¸æ“šæ ¼å¼å’ŒUIç¶å®šå•é¡Œï¼Œå¹«åŠ©è§£æ±ºæ‰“åŒ…å¾Œå‰ç«¯ç•«é¢ä¸æ›´æ–°çš„å•é¡Œ
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸš¨ å•é¡Œåˆ†æ</h3>
            <p>æ ¹æ“šæ‚¨çš„æè¿°ï¼Œæ‰“åŒ…å®Œå‰ç«¯æ²’æœ‰æ›´æ–°ç•«é¢ï¼Œå¯èƒ½çš„åŸå› ï¼š</p>
            
            <div class="problem-category">
                <h4>1. ç‹€æ…‹æ²’æ”¹è®Šï¼ˆstate/reactive æ²’æ­£ç¢ºæ›´æ–°ï¼‰</h4>
                <p>æ‰“åŒ…çµæœçš„ç‹€æ…‹è®Šé‡æ²’æœ‰æ­£ç¢ºæ›´æ–°ï¼Œå°è‡´UIç„¡æ³•åæ˜ æ–°æ•¸æ“š</p>
                <div class="solution">
                    <strong>è§£æ±ºæ–¹æ¡ˆï¼š</strong> ä½¿ç”¨å¼·åˆ¶DOMæ›´æ–°ã€äº‹ä»¶è§¸ç™¼å’Œç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶
                </div>
            </div>
            
            <div class="problem-category">
                <h4>2. API æ²’å›ä¾†æˆ–è³‡æ–™æ ¼å¼éŒ¯</h4>
                <p>å¾Œç«¯APIæ²’æœ‰è¿”å›æ•¸æ“šï¼Œæˆ–è€…è¿”å›çš„æ•¸æ“šæ ¼å¼èˆ‡å‰ç«¯æœŸæœ›ä¸ç¬¦</p>
                <div class="solution">
                    <strong>è§£æ±ºæ–¹æ¡ˆï¼š</strong> å¢å¼·æ•¸æ“šæ ¼å¼æª¢æ¸¬ã€æ·±åº¦æœç´¢å’Œå¾Œå‚™æ•¸æ“šæ©Ÿåˆ¶
                </div>
            </div>
            
            <div class="problem-category">
                <h4>3. UI æ²’æœ‰æ­£ç¢ºç¶å®š state</h4>
                <p>UIå…ƒç´ èˆ‡ç‹€æ…‹è®Šé‡ä¹‹é–“çš„ç¶å®šé—œä¿‚ä¸æ­£ç¢ºï¼Œç‹€æ…‹è®ŠåŒ–ç„¡æ³•åæ˜ åˆ°ç•Œé¢</p>
                <div class="solution">
                    <strong>è§£æ±ºæ–¹æ¡ˆï¼š</strong> æ·»åŠ äº‹ä»¶ç›£è½å™¨ã€DOMè®ŠåŒ–ç›£è½å’Œå¼·åˆ¶é‡ç¹ªæ©Ÿåˆ¶
                </div>
            </div>
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸ” å•é¡Œ1ï¼šç‹€æ…‹æ›´æ–°æª¢æŸ¥</h3>
            <p>æª¢æŸ¥æ‰“åŒ…çµæœçš„ç‹€æ…‹è®Šé‡æ˜¯å¦æ­£ç¢ºæ›´æ–°</p>
            <button class="test-button" onclick="checkStateUpdate()">æª¢æŸ¥ç‹€æ…‹æ›´æ–°</button>
            <button class="test-button" onclick="forceStateUpdate()">å¼·åˆ¶ç‹€æ…‹æ›´æ–°</button>
            <button class="test-button" onclick="monitorStateChanges()">ç›£æ§ç‹€æ…‹è®ŠåŒ–</button>
            <div id="state-result" class="result-display" style="display: none;"></div>
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸŒ å•é¡Œ2ï¼šAPIæ•¸æ“šæ ¼å¼æª¢æŸ¥</h3>
            <p>æª¢æŸ¥APIè¿”å›çš„æ•¸æ“šæ ¼å¼å’Œè§£æéç¨‹</p>
            <button class="test-button" onclick="checkAPIData()">æª¢æŸ¥APIæ•¸æ“š</button>
            <button class="test-button" onclick="testDataParsing()">æ¸¬è©¦æ•¸æ“šè§£æ</button>
            <button class="test-button" onclick="simulateAPIResponse()">æ¨¡æ“¬APIéŸ¿æ‡‰</button>
            <div id="api-result" class="result-display" style="display: none;"></div>
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸ¨ å•é¡Œ3ï¼šUIç¶å®šæª¢æŸ¥</h3>
            <p>æª¢æŸ¥UIå…ƒç´ èˆ‡ç‹€æ…‹è®Šé‡çš„ç¶å®šé—œä¿‚</p>
            <button class="test-button" onclick="checkUIBinding()">æª¢æŸ¥UIç¶å®š</button>
            <button class="test-button" onclick="testDOMUpdate()">æ¸¬è©¦DOMæ›´æ–°</button>
            <button class="test-button" onclick="forceUIRefresh()">å¼·åˆ¶UIåˆ·æ–°</button>
            <div id="ui-result" class="result-display" style="display: none;"></div>
        </div>
        
        <div class="diagnostic-section">
            <h3>ğŸ§ª ç¶œåˆè¨ºæ–·</h3>
            <p>åŸ·è¡Œå®Œæ•´çš„ç³»çµ±è¨ºæ–·</p>
            <button class="test-button success" onclick="runFullDiagnostic()">é‹è¡Œå®Œæ•´è¨ºæ–·</button>
            <button class="test-button warning" onclick="testPackingFlow()">æ¸¬è©¦å®Œæ•´æ‰“åŒ…æµç¨‹</button>
            <button class="test-button error" onclick="resetSystem()">é‡ç½®ç³»çµ±ç‹€æ…‹</button>
            <div id="diagnostic-result" class="result-display" style="display: none;"></div>
        </div>
        
        <a href="../index.html" class="back-link">â† è¿”å›ä¸»é </a>
    </div>

    <script>
        // å•é¡Œ1ï¼šç‹€æ…‹æ›´æ–°æª¢æŸ¥
        function checkStateUpdate() {
            const resultDiv = document.getElementById('state-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ” æª¢æŸ¥ç‹€æ…‹æ›´æ–°...';
            
            try {
                const checks = {
                    scene: typeof window.scene !== 'undefined',
                    camera: typeof window.camera !== 'undefined',
                    renderer: typeof window.renderer !== 'undefined',
                    objectManager: typeof window.objectManager !== 'undefined',
                    packingManager: typeof window.packingManager !== 'undefined'
                };
                
                let result = 'ğŸ“‹ ç‹€æ…‹æ›´æ–°æª¢æŸ¥çµæœ:\n\n';
                let allAvailable = true;
                
                Object.entries(checks).forEach(([key, exists]) => {
                    const status = exists ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨';
                    const icon = exists ? 'ğŸŸ¢' : 'ğŸ”´';
                    result += `${icon} ${key}: ${status}\n`;
                    if (!exists) allAvailable = false;
                });
                
                if (allAvailable) {
                    result += '\nğŸ‰ æ‰€æœ‰åŸºç¤çµ„ä»¶éƒ½å¯ç”¨ï¼\n';
                    result += 'ğŸ” æª¢æŸ¥æ‰“åŒ…ç®¡ç†å™¨ç‹€æ…‹...\n';
                    
                    // æª¢æŸ¥æ‰“åŒ…ç®¡ç†å™¨çš„å…§éƒ¨ç‹€æ…‹
                    if (window.packingManager) {
                        result += 'âœ… æ‰“åŒ…ç®¡ç†å™¨å¯¦ä¾‹å­˜åœ¨\n';
                        result += `ğŸ“¦ ç‰©ä»¶æ•¸é‡: ${window.objectManager.getObjects().length}\n`;
                    }
                } else {
                    result += '\nâš ï¸ éƒ¨åˆ†çµ„ä»¶ä¸å¯ç”¨ï¼Œè«‹å…ˆç¢ºä¿ä¸»æ‡‰ç”¨ç¨‹å¼æ­£å¸¸é‹è¡Œ';
                }
                
                resultDiv.innerHTML = `<span class="status-indicator status-success"></span>${result}`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ ç‹€æ…‹æ›´æ–°æª¢æŸ¥å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        function forceStateUpdate() {
            const resultDiv = document.getElementById('state-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ å¼·åˆ¶ç‹€æ…‹æ›´æ–°...';
            
            try {
                // å¼·åˆ¶æ›´æ–°DOMå…ƒç´ 
                const utilizationElement = document.getElementById('utilization-text');
                const executionTimeElement = document.getElementById('execution-time-text');
                
                if (utilizationElement && executionTimeElement) {
                    // è§¸ç™¼å¼·åˆ¶æ›´æ–°
                    utilizationElement.textContent = 'æ¸¬è©¦å€¼: 85.5%';
                    executionTimeElement.textContent = 'æ¸¬è©¦å€¼: 2.3s';
                    
                    // è§¸ç™¼äº‹ä»¶
                    utilizationElement.dispatchEvent(new Event('change', { bubbles: true }));
                    executionTimeElement.dispatchEvent(new Event('input', { bubbles: true }));
                    
                    resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… å¼·åˆ¶ç‹€æ…‹æ›´æ–°å®Œæˆ!\n\n` +
                        `é«”ç©åˆ©ç”¨ç‡å·²è¨­ç½®ç‚º: 85.5%\n` +
                        `åŸ·è¡Œæ™‚é–“å·²è¨­ç½®ç‚º: 2.3s\n\n` +
                        `è«‹æª¢æŸ¥ä¸»é é¢æ˜¯å¦é¡¯ç¤ºé€™äº›å€¼`;
                        
                } else {
                    resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ æ‰¾ä¸åˆ°ç›®æ¨™DOMå…ƒç´ `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ å¼·åˆ¶ç‹€æ…‹æ›´æ–°å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        function monitorStateChanges() {
            const resultDiv = document.getElementById('state-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ‘ï¸ é–‹å§‹ç›£æ§ç‹€æ…‹è®ŠåŒ–...';
            
            try {
                // è¨­ç½®ç‹€æ…‹ç›£æ§
                let changeCount = 0;
                const targetNode = document.getElementById('packing-results');
                
                if (targetNode) {
                    const observer = new MutationObserver((mutations) => {
                        changeCount++;
                        resultDiv.innerHTML = `<span class="status-indicator status-info"></span>ğŸ”„ ç‹€æ…‹è®ŠåŒ–ç›£æ§ä¸­...\n\n` +
                            `æª¢æ¸¬åˆ° ${changeCount} æ¬¡DOMè®ŠåŒ–\n` +
                            `æœ€å¾Œä¸€æ¬¡è®ŠåŒ–: ${new Date().toLocaleTimeString()}\n\n` +
                            `è®ŠåŒ–é¡å‹: ${mutations.map(m => m.type).join(', ')}`;
                    });
                    
                    observer.observe(targetNode, {
                        childList: true,
                        characterData: true,
                        subtree: true
                    });
                    
                    resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… ç‹€æ…‹è®ŠåŒ–ç›£æ§å·²å•Ÿå‹•!\n\n` +
                        `æ­£åœ¨ç›£æ§æ‰“åŒ…çµæœå€åŸŸçš„è®ŠåŒ–...\n` +
                        `è«‹åŸ·è¡Œæ‰“åŒ…æ“ä½œï¼Œè§€å¯Ÿè®ŠåŒ–æª¢æ¸¬`;
                        
                    // 10ç§’å¾Œåœæ­¢ç›£æ§
                    setTimeout(() => {
                        observer.disconnect();
                        resultDiv.innerHTML += '\n\nâ° ç›£æ§å·²åœæ­¢ï¼ˆ10ç§’è¶…æ™‚ï¼‰';
                    }, 10000);
                    
                } else {
                    resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ æ‰¾ä¸åˆ°ç›£æ§ç›®æ¨™ç¯€é»`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ ç‹€æ…‹è®ŠåŒ–ç›£æ§å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        // å•é¡Œ2ï¼šAPIæ•¸æ“šæ ¼å¼æª¢æŸ¥
        function checkAPIData() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸŒ æª¢æŸ¥APIæ•¸æ“š...';
            
            try {
                // æª¢æŸ¥APIé€£æ¥
                fetch('http://localhost:8889/health')
                    .then(response => response.json())
                    .then(data => {
                        resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… APIé€£æ¥æª¢æŸ¥æˆåŠŸ!\n\n` +
                            `æœå‹™å™¨ç‹€æ…‹: ${data.status}\n` +
                            `æœå‹™åç¨±: ${data.service}\n\n` +
                            `å¾Œç«¯APIæœå‹™å™¨é‹è¡Œæ­£å¸¸`;
                    })
                    .catch(error => {
                        resultDiv.innerHTML = `<span class="status-indicator status-warning"></span>âš ï¸ APIé€£æ¥æª¢æŸ¥å¤±æ•—\n\n` +
                            `éŒ¯èª¤: ${error.message}\n\n` +
                            `å»ºè­°ï¼š\n` +
                            `1. æª¢æŸ¥å¾Œç«¯æœå‹™å™¨æ˜¯å¦é‹è¡Œ\n` +
                            `2. ç¢ºèªç«¯å£ 8889 æ˜¯å¦æ­£ç¢º\n` +
                            `3. æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®`;
                    });
                    
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ APIæ•¸æ“šæª¢æŸ¥å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        function testDataParsing() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ§ª æ¸¬è©¦æ•¸æ“šè§£æ...';
            
            try {
                // æ¸¬è©¦ä¸åŒçš„æ•¸æ“šæ ¼å¼
                const testData = [
                    {
                        name: 'æ¨™æº–æ ¼å¼',
                        data: {
                            packed_objects: [{ uuid: 'test1', position: { x: 0, y: 0, z: 0 } }],
                            volume_utilization: 0.85,
                            execution_time: 2.5
                        }
                    },
                    {
                        name: 'åµŒå¥—æ ¼å¼',
                        data: {
                            result: {
                                packed_objects: [{ uuid: 'test2', position: { x: 10, y: 10, z: 10 } }],
                                volume_utilization: 0.90,
                                execution_time: 1.8
                            }
                        }
                    },
                    {
                        name: 'é™£åˆ—æ ¼å¼',
                        data: [{ uuid: 'test3', position: { x: 20, y: 20, z: 20 } }]
                    }
                ];
                
                let result = 'ğŸ§ª æ•¸æ“šè§£ææ¸¬è©¦çµæœ:\n\n';
                
                testData.forEach((test, index) => {
                    result += `ğŸ“‹ æ¸¬è©¦ ${index + 1}: ${test.name}\n`;
                    result += `è¼¸å…¥æ•¸æ“š: ${JSON.stringify(test.data, null, 2)}\n`;
                    
                    // æ¨¡æ“¬è§£æéç¨‹
                    let packedObjects = [];
                    let utilization = null;
                    let executionTime = null;
                    
                    if (test.data.packed_objects) {
                        packedObjects = test.data.packed_objects;
                        utilization = test.data.volume_utilization || test.data.utilization;
                        executionTime = test.data.execution_time;
                    } else if (Array.isArray(test.data)) {
                        packedObjects = test.data;
                    } else if (test.data.result && test.data.result.packed_objects) {
                        packedObjects = test.data.result.packed_objects;
                        utilization = test.data.result.volume_utilization;
                        executionTime = test.data.result.execution_time;
                    }
                    
                    result += `è§£æçµæœ:\n`;
                    result += `  æ‰“åŒ…ç‰©ä»¶: ${packedObjects.length} å€‹\n`;
                    result += `  åˆ©ç”¨ç‡: ${utilization || 'N/A'}\n`;
                    result += `  åŸ·è¡Œæ™‚é–“: ${executionTime || 'N/A'}\n\n`;
                });
                
                resultDiv.innerHTML = `<span class="status-indicator status-success"></span>${result}`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ æ•¸æ“šè§£ææ¸¬è©¦å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        function simulateAPIResponse() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ­ æ¨¡æ“¬APIéŸ¿æ‡‰...';
            
            try {
                // å‰µå»ºæ¨¡æ“¬çš„APIéŸ¿æ‡‰
                const mockResponse = {
                    job_id: 'mock_123',
                    status: 'completed',
                    result: {
                        algorithm_used: 'blf_sa',
                        execution_time: 2.8,
                        packed_objects: [
                            { uuid: 'mock1', position: { x: 0, y: 0, z: 0 }, dimensions: { x: 15, y: 15, z: 15 } },
                            { uuid: 'mock2', position: { x: 15, y: 0, z: 0 }, dimensions: { x: 15, y: 15, z: 15 } },
                            { uuid: 'mock3', position: { x: 30, y: 0, z: 0 }, dimensions: { x: 15, y: 15, z: 15 } }
                        ],
                        volume_utilization: 0.92
                    }
                };
                
                resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… æ¨¡æ“¬APIéŸ¿æ‡‰å‰µå»ºæˆåŠŸ!\n\n` +
                    `æ¨¡æ“¬æ•¸æ“š:\n${JSON.stringify(mockResponse, null, 2)}\n\n` +
                    `é€™å€‹æ•¸æ“šæ‡‰è©²èƒ½è¢«å‰ç«¯æ­£ç¢ºè§£æå’Œé¡¯ç¤º`;
                    
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ æ¨¡æ“¬APIéŸ¿æ‡‰å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        // å•é¡Œ3ï¼šUIç¶å®šæª¢æŸ¥
        function checkUIBinding() {
            const resultDiv = document.getElementById('ui-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ¨ æª¢æŸ¥UIç¶å®š...';
            
            try {
                const checks = {
                    'packing-panel': document.getElementById('packing-panel'),
                    'utilization-text': document.getElementById('utilization-text'),
                    'execution-time-text': document.getElementById('execution-time-text'),
                    'packing-progress': document.getElementById('packing-progress'),
                    'progress-fill': document.querySelector('.progress-fill'),
                    'progress-text': document.querySelector('.progress-text'),
                    'progress-status': document.querySelector('.progress-status')
                };
                
                let result = 'ğŸ“‹ UIç¶å®šæª¢æŸ¥çµæœ:\n\n';
                let allFound = true;
                
                Object.entries(checks).forEach(([key, element]) => {
                    const status = element ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°';
                    const icon = element ? 'ğŸŸ¢' : 'ğŸ”´';
                    result += `${icon} ${key}: ${status}\n`;
                    if (!element) allFound = false;
                });
                
                if (allFound) {
                    result += '\nğŸ‰ æ‰€æœ‰UIå…ƒç´ éƒ½æ‰¾åˆ°ï¼\n';
                    result += 'ğŸ” æª¢æŸ¥å…ƒç´ å±¬æ€§...\n';
                    
                    // æª¢æŸ¥é—œéµå±¬æ€§
                    const utilizationElement = checks['utilization-text'];
                    const executionTimeElement = checks['execution-time-text'];
                    
                    result += `é«”ç©åˆ©ç”¨ç‡å…ƒç´ :\n`;
                    result += `  æ–‡æœ¬å…§å®¹: "${utilizationElement.textContent}"\n`;
                    result += `  å¯è¦‹æ€§: ${utilizationElement.style.display !== 'none' ? 'å¯è¦‹' : 'éš±è—'}\n`;
                    
                    result += `åŸ·è¡Œæ™‚é–“å…ƒç´ :\n`;
                    result += `  æ–‡æœ¬å…§å®¹: "${executionTimeElement.textContent}"\n`;
                    result += `  å¯è¦‹æ€§: ${executionTimeElement.style.display !== 'none' ? 'å¯è¦‹' : 'éš±è—'}\n`;
                    
                } else {
                    result += '\nâš ï¸ éƒ¨åˆ†UIå…ƒç´ æœªæ‰¾åˆ°ï¼Œé€™å¯èƒ½æ˜¯å•é¡Œçš„æ ¹æº';
                }
                
                resultDiv.innerHTML = `<span class="status-indicator status-success"></span>${result}`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ UIç¶å®šæª¢æŸ¥å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        function testDOMUpdate() {
            const resultDiv = document.getElementById('ui-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ§ª æ¸¬è©¦DOMæ›´æ–°...';
            
            try {
                // æ¸¬è©¦DOMæ›´æ–°åŠŸèƒ½
                const utilizationElement = document.getElementById('utilization-text');
                const executionTimeElement = document.getElementById('execution-time-text');
                
                if (utilizationElement && executionTimeElement) {
                    // ä¿å­˜åŸå§‹å€¼
                    const originalUtilization = utilizationElement.textContent;
                    const originalExecutionTime = executionTimeElement.textContent;
                    
                    // è¨­ç½®æ¸¬è©¦å€¼
                    utilizationElement.textContent = 'æ¸¬è©¦: 88.5%';
                    executionTimeElement.textContent = 'æ¸¬è©¦: 3.2s';
                    
                    // æ·»åŠ è¦–è¦ºåé¥‹
                    utilizationElement.style.color = '#ff6b6b';
                    executionTimeElement.style.color = '#ff6b6b';
                    
                    resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… DOMæ›´æ–°æ¸¬è©¦å®Œæˆ!\n\n` +
                        `åŸå§‹å€¼:\n` +
                        `  é«”ç©åˆ©ç”¨ç‡: "${originalUtilization}"\n` +
                        `  åŸ·è¡Œæ™‚é–“: "${originalExecutionTime}"\n\n` +
                        `æ¸¬è©¦å€¼:\n` +
                        `  é«”ç©åˆ©ç”¨ç‡: "æ¸¬è©¦: 88.5%" (ç´…è‰²)\n` +
                        `  åŸ·è¡Œæ™‚é–“: "æ¸¬è©¦: 3.2s" (ç´…è‰²)\n\n` +
                        `è«‹æª¢æŸ¥ä¸»é é¢æ˜¯å¦é¡¯ç¤ºé€™äº›æ¸¬è©¦å€¼`;
                    
                    // 3ç§’å¾Œæ¢å¾©åŸå§‹å€¼
                    setTimeout(() => {
                        utilizationElement.textContent = originalUtilization;
                        executionTimeElement.textContent = originalExecutionTime;
                        utilizationElement.style.color = '';
                        executionTimeElement.style.color = '';
                        resultDiv.innerHTML += '\n\nğŸ”„ å·²æ¢å¾©åŸå§‹å€¼';
                    }, 3000);
                    
                } else {
                    resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ æ‰¾ä¸åˆ°æ¸¬è©¦ç›®æ¨™å…ƒç´ `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ DOMæ›´æ–°æ¸¬è©¦å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        function forceUIRefresh() {
            const resultDiv = document.getElementById('ui-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ å¼·åˆ¶UIåˆ·æ–°...';
            
            try {
                // å¼·åˆ¶åˆ·æ–°UI
                const packingPanel = document.getElementById('packing-panel');
                if (packingPanel) {
                    // è§¸ç™¼é‡æ’å’Œé‡ç¹ª
                    packingPanel.style.display = 'none';
                    packingPanel.offsetHeight; // å¼·åˆ¶é‡æ’
                    packingPanel.style.display = 'block';
                    
                    // è§¸ç™¼å‹•ç•«
                    packingPanel.style.transform = 'scale(1.02)';
                    packingPanel.style.transition = 'transform 0.2s ease';
                    
                    setTimeout(() => {
                        packingPanel.style.transform = 'scale(1)';
                    }, 200);
                    
                    resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… UIå¼·åˆ¶åˆ·æ–°å®Œæˆ!\n\n` +
                        `å·²è§¸ç™¼:\n` +
                        `1. é¢æ¿é‡æ’\n` +
                        `2. ç¸®æ”¾å‹•ç•«\n` +
                        `3. éæ¸¡æ•ˆæœ\n\n` +
                        `è«‹æª¢æŸ¥ä¸»é é¢çš„UIæ˜¯å¦æœ‰è®ŠåŒ–`;
                        
                } else {
                    resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ æ‰¾ä¸åˆ°æ‰“åŒ…é¢æ¿å…ƒç´ `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ UIå¼·åˆ¶åˆ·æ–°å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        // ç¶œåˆè¨ºæ–·
        function runFullDiagnostic() {
            const resultDiv = document.getElementById('diagnostic-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”§ é‹è¡Œå®Œæ•´è¨ºæ–·...';
            
            // åŸ·è¡Œæ‰€æœ‰æª¢æŸ¥
            setTimeout(() => checkStateUpdate(), 500);
            setTimeout(() => checkAPIData(), 1000);
            setTimeout(() => checkUIBinding(), 1500);
            
            setTimeout(() => {
                resultDiv.innerHTML = `<span class="status-indicator status-info"></span>ğŸ”§ å®Œæ•´è¨ºæ–·å®Œæˆ!\n\n` +
                    `å·²åŸ·è¡Œä»¥ä¸‹æª¢æŸ¥:\n` +
                    `âœ… ç‹€æ…‹æ›´æ–°æª¢æŸ¥\n` +
                    `âœ… APIæ•¸æ“šæª¢æŸ¥\n` +
                    `âœ… UIç¶å®šæª¢æŸ¥\n\n` +
                    `è«‹æŸ¥çœ‹ä¸Šæ–¹å„é …æª¢æŸ¥çš„çµæœï¼Œæ‰¾å‡ºå•é¡Œæ‰€åœ¨`;
            }, 2000);
        }
        
        function testPackingFlow() {
            const resultDiv = document.getElementById('diagnostic-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ§ª æ¸¬è©¦å®Œæ•´æ‰“åŒ…æµç¨‹...';
            
            try {
                if (window.packingManager) {
                    // åŸ·è¡Œæ‰“åŒ…æ¸¬è©¦
                    window.packingManager.executePacking();
                    
                    resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… å®Œæ•´æ‰“åŒ…æµç¨‹æ¸¬è©¦å·²å•Ÿå‹•!\n\n` +
                        `è«‹è§€å¯Ÿ:\n` +
                        `1. é€²åº¦æ¢æ˜¯å¦æ­£å¸¸é¡¯ç¤º\n` +
                        `2. ç‰©ä»¶æ˜¯å¦ç§»å‹•åˆ°æ–°ä½ç½®\n` +
                        `3. çµæœæ˜¯å¦æ­£ç¢ºé¡¯ç¤º\n\n` +
                        `æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒä»¥ç²å–è©³ç´°ä¿¡æ¯`;
                        
                } else {
                    resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ æ‰“åŒ…ç®¡ç†å™¨ä¸å¯ç”¨`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ å®Œæ•´æ‰“åŒ…æµç¨‹æ¸¬è©¦å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        function resetSystem() {
            const resultDiv = document.getElementById('diagnostic-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ é‡ç½®ç³»çµ±ç‹€æ…‹...';
            
            try {
                // é‡ç½®UIå…ƒç´ 
                const utilizationElement = document.getElementById('utilization-text');
                const executionTimeElement = document.getElementById('execution-time-text');
                
                if (utilizationElement) utilizationElement.textContent = '-';
                if (executionTimeElement) executionTimeElement.textContent = '-';
                
                // é‡ç½®é€²åº¦æ¢
                const progressFill = document.querySelector('.progress-fill');
                const progressText = document.querySelector('.progress-text');
                const progressStatus = document.querySelector('.progress-status');
                
                if (progressFill) progressFill.style.width = '0%';
                if (progressText) progressText.textContent = '0%';
                if (progressStatus) {
                    progressStatus.textContent = 'æº–å‚™ä¸­...';
                    progressStatus.className = 'progress-status status-pending';
                }
                
                resultDiv.innerHTML = `<span class="status-indicator status-success"></span>âœ… ç³»çµ±ç‹€æ…‹é‡ç½®å®Œæˆ!\n\n` +
                    `å·²é‡ç½®:\n` +
                    `1. é«”ç©åˆ©ç”¨ç‡é¡¯ç¤º\n` +
                    `2. åŸ·è¡Œæ™‚é–“é¡¯ç¤º\n` +
                    `3. é€²åº¦æ¢ç‹€æ…‹\n` +
                    `4. é€²åº¦ç‹€æ…‹æ–‡å­—\n\n` +
                    `ç¾åœ¨å¯ä»¥é‡æ–°æ¸¬è©¦æ‰“åŒ…åŠŸèƒ½`;
                    
            } catch (error) {
                resultDiv.innerHTML = `<span class="status-indicator status-error"></span>âŒ ç³»çµ±ç‹€æ…‹é‡ç½®å¤±æ•—\n\néŒ¯èª¤: ${error.message}`;
            }
        }
        
        // é é¢åŠ è¼‰å®Œæˆå¾Œè‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                console.log('ğŸ”§ è¨ºæ–·å·¥å…·å·²åŠ è¼‰ï¼Œå¯ä»¥é–‹å§‹è¨ºæ–·å•é¡Œ');
            }, 1000);
        });
    </script>
</body>
</html>
